<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Riset Operasi Baru</title>

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link
            href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
            rel="stylesheet">

        <style>
            body {
                font-family: 'Poppins', sans-serif;
            }
        </style>

        <script src="public/tailwind.js"></script>
        <script src="public/chart.js"></script>
        <script src="public/jquery.js"></script>
    </head>

    <body class="bg-gradient-to-b from-zinc-800 to-black">
        <nav class="bg-zinc-900 shadow">
            <div class="max-w-screen-2xl flex flex-wrap items-center justify-center md:justify-between mx-20 p-4"
                bis_skin_checked="1">
                <img alt="Logo ITATS" loading="lazy" width="140" height="100" decoding="async" data-nimg="1"
                    class="h-10" style="color:transparent" src="public/itats.png">
                <img alt="Logo Informatika" loading="lazy" width="180" height="100" decoding="async" data-nimg="1"
                    class="h-8  hidden md:block" style="color:transparent" src="public/informatika.png">
            </div>
        </nav>

        <div class="relative px-4 sm:px-6 flex flex-col gap-2 md:gap-4 justify-center items-center min-h-screen max-w-screen-lg mx-auto"
            bis_skin_checked="1">
            <div class="absolute left-0 flex flex-col gap-2 md:gap-4 justify-center items-center">
                <p class="text-xs md:text-md font-bold tracking-widest mt-[-30%] md:mt-[-6.5%] uppercase text-zinc-300">
                    Riset Operasi
                </p>
                <p
                class="text-3xl md:text-3xl text-center font-bold tracking-wider md:tracking-widest uppercase text-white">
                Particle Swarm Optimization (PSO)
            </p>
            <p class="text-[10px] md:text-sm text-center font-medium uppercase max-w-3xl tracking-wide text-zinc-300">
                Particle Swarm Optimization (PSO) adalah algoritma metaheuristik populer yang digunakan untuk memecahkan
                masalah optimasi. Ini terinspirasi dari perilaku kawanan di alam, seperti kawanan burung atau kawanan
                ikan. Algoritme didasarkan pada gagasan bahwa partikel individu dalam kawanan dapat berkomunikasi satu
                sama lain dan bekerja sama untuk menemukan solusi optimal.</p>
            </div>

            <img src="public/zeus.png" class="absolute bottom-[20%] right-[-20%] z-[-1]" />
        </div>

        <div class="mx-auto max-w-[1300px] px-4 sm:px-6 flex flex-col justify-center items-center gap-4 py-24">
            <div class="flex flex-col items-center gap-4">
                <h1 class="text-center text-2xl font-bold text-white">Pengujian PSO</h1>

                <div id="pso-info" class="flex flex-col justify-center items-center gap-6">
                    <div class="overflow-hidden rounded-lg py-2 px-3 bg-zinc-800 text-white">
                        <table class="border-collapse">
                            <thead>
                                <tr>
                                    <th class="font-semibold tracking-wide border border-zinc-600 p-2">Partikel</th>
                                    <th class="font-semibold tracking-wide border border-zinc-600 p-2">Posisi</th>
                                    <th class="font-semibold tracking-wide border border-zinc-600 p-2">Fitness</th>
                                    <th class="font-semibold tracking-wide border border-zinc-600 p-2">Kecepatan</th>
                                    <th class="font-semibold tracking-wide border border-zinc-600 p-2">PBest</th>
                                    <th class="font-semibold tracking-wide border border-zinc-600 p-2">PBest Fitness
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="particleTableBody"></tbody>
                        </table>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full max-w-5xl">
                        <div class="flex flex-col justify-center items-center rounded-lg bg-zinc-200 p-2">
                            <p class="font-semibold">GBest Fitness</p>
                            <p id="gbestFitness">?</p>
                        </div>
                        <div class="flex flex-col justify-center items-center rounded-lg bg-zinc-200 p-2">
                            <p class="font-semibold">GBest Position</p>
                            <p id="gbestPosition">?</p>
                        </div>
                    </div>
                </div>

                <div class="text-center">
                    <button id="startButton"
                        class="bg-blue-500 hover:bg-blue-600 transition text-white rounded-lg px-5 py-2 rounded font-medium">Start
                        Iteration</button>
                </div>
            </div>

            <div class="flex flex-col md:flex-row gap-4 w-full">
                <div class="w-full bg-zinc-900 rounded-lg p-4">
                    <canvas id="fitnessChart" width="400" height="200"></canvas>
                </div>

                <!--menginisialisasi scatter-->
                <div class="w-full bg-zinc-900 rounded-lg p-4">
                    <canvas id="scatterChart" width="400" height="200"></canvas>
                </div>
            </div>

        </div>

        <footer
            class="mx-auto max-w-[1300px] py-12 px-4 sm:px-6 md:flex md:items-center md:justify-between lg:px-8 text-zinc-300">
            <div class="mt-8 md:mt-0" bis_skin_checked="1">
                <p class="flex flex-row gap-2">
                    Made With â˜• By <a href="https://github.com/AvuxDemons" target="_blank" class="flex flex-row gap-2">
                        <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512"
                            class="h-5 w-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z">
                            </path>
                        </svg>
                        <span class="font-semibold hover:text-white transition">Davin Tistama B.S</span>
                    </a>
                    <a href="https://github.com/pemenkaret" target="_blank" class="flex flex-row gap-2">
                        <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512"
                            class="h-5 w-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z">
                            </path>
                        </svg>
                        <span class="font-semibold hover:text-white transition">
                            Pandu Agung Adidarma
                        </span>
                    </a>
                </p>
            </div>
        </footer>

        <script type="module">
            import { Rosenbrock } from "./rosenbrock.js";
            import { PSO } from "./pso.js";

            const tableBody = $('#particleTableBody');
            const gbestFitnessElement = $('#gbestFitness');
            const gbestPositionElement = $('#gbestPosition');
            const startButton = $('#startButton');
            const psoInfo = $('#pso-info');

            const n_particle = 6;
            const pso = new PSO(n_particle, 2, Rosenbrock);

            let iteration = 0;
            let gbestFitnessData = [];
            let labels = [];
            let particlePositions = [];
            let gbestPositions = [];

            const showLoadingRow = () => {
                const loadingRow = `
                    <tr>
                        <td colspan="6" class="border border-zinc-600 p-2 text-center">No Data...</td>
                    </tr>
                `;
                tableBody.html(loadingRow);
            }

            const colorGradient = (startColor, endColor, steps, step) => {
                const interpolate = (start, end, step, maxStep) => start + (end - start) * (step / maxStep);
                const r = interpolate(startColor[0], endColor[0], step, steps);
                const g = interpolate(startColor[1], endColor[1], step, steps);
                const b = interpolate(startColor[2], endColor[2], step, steps);
                return `rgb(${Math.round(r)}, ${Math.round(g)}, ${Math.round(b)})`;
            }

            const fitnessChart = new Chart($('#fitnessChart')[0].getContext('2d'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Gbest Fitness',
                        data: gbestFitnessData,
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        fill: true,
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Iteration'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Gbest Fitness'
                            }
                        }
                    }
                }
            });

            const scatterChart = new Chart($('#scatterChart')[0].getContext('2d'), {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'Particle Positions',
                            data: [],
                            pointBackgroundColor: [],
                            pointBorderColor: [],
                            pointRadius: 5,
                            order: 1,
                        },
                        {
                            label: 'GBest Position',
                            data: [],
                            pointBackgroundColor: [],
                            pointBorderColor: [],
                            pointRadius: 7,
                            order: 0,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Position X'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Position Y'
                            }
                        }
                    }
                }
            });

            const updateTable = () => {
                if (pso.particles.length === 0) {
                    showLoadingRow();
                    return;
                }

                tableBody.empty();

                pso.particles.forEach((particle, index) => {
                    const row = `
                    <tr>
                        <td class="border border-zinc-600 p-2 text-center">${index + 1}</td>
                        <td class="border border-zinc-600 p-2 text-center">${particle.position.join(', ')}</td>
                        <td class="border border-zinc-600 p-2 text-center">${particle.fitness}</td>
                        <td class="border border-zinc-600 p-2 text-center">${particle.velocity.join(', ')}</td>
                        <td class="border border-zinc-600 p-2 text-center">${particle.pbest.join(', ')}</td>
                        <td class="border border-zinc-600 p-2 text-center">${particle.pbestFitness}</td>
                    </tr>`;
                    tableBody.append(row);
                });

                gbestFitnessElement.text(pso.gbestFitness);
                gbestPositionElement.text(pso.gbestPosition.join(', '));
            }

            

            const updateCharts = () => {
                labels.push(iteration);
                gbestFitnessData.push(pso.gbestFitness);
                fitnessChart.update();
            }

            const updateScatterChart = () => {
                const lightBlue = [173, 216, 230];
                const darkBlue = [0, 0, 139];
                const lightRed = [255, 160, 122];
                const darkRed = [139, 0, 0];

                pso.particles.forEach((particle) => {
                    scatterChart.data.datasets[0].data.push({
                        x: particle.position[0],
                        y: particle.position[1]
                    });
                    scatterChart.data.datasets[0].pointBackgroundColor.push(
                        colorGradient(lightBlue, darkBlue, 20, iteration)
                    );
                    scatterChart.data.datasets[0].pointBorderColor.push(
                        colorGradient(lightBlue, darkBlue, 20, iteration)
                    );
                });

                scatterChart.data.datasets[1].data.push({
                    x: pso.gbestPosition[0],
                    y: pso.gbestPosition[1]
                });
                scatterChart.data.datasets[1].pointBackgroundColor.push(
                    colorGradient(lightRed, darkRed, 20, iteration)
                );
                scatterChart.data.datasets[1].pointBorderColor.push(
                    colorGradient(lightRed, darkRed, 20, iteration)
                );

                scatterChart.update();
            }

            const runPSOIteration = () => {
                const maxIteration = 20;
                const interval = setInterval(() => {
                    if (iteration >= maxIteration) {
                        clearInterval(interval);
                        console.log('Iterasi PSO selesai!');
                        alert('Iterasi PSO selesai!');
                        startButton.fadeToggle();
                        return;
                    }
                    pso.mainPSO();
                    updateTable();
                    updateCharts();
                    updateScatterChart();
                    iteration++;
                }, 1000);
            }

            showLoadingRow();

            startButton.on('click', () => {
                iteration = 0;
                scatterChart.data.datasets[0].data = [];
                scatterChart.data.datasets[0].pointBackgroundColor = [];
                scatterChart.data.datasets[1].data = [];
                scatterChart.data.datasets[1].pointBackgroundColor = [];

                startButton.fadeToggle();
                runPSOIteration();
            });
        </script>
    </body>

</html>